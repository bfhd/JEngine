import org.jengine.tools.hl7.Segment;^M
import org.jengine.tools.hl7.Field;^M
log.info("Dictaphone to RMC");^M
// 4^M
String send_facility = message.sendingFacility.toString();^M
String rcv_facility = message.receivingFacility.toString();^M
String rcv_app = message.receivingApplication.toString();^M
String msgType = message.messageType.toString();^M
String version = message.versionID.toString();^M
//10^M
Message.versionID = new Field("2.2");^M
if (rcv_facility.equals("2") == true) {^M
   message.receivingFacility = new Field("076");^M
   message.sendingFacility = new Field("076");^M
}^M
//16^M
^M
   // strip off order based transactions for now!^M
log.info("Message Type " +msgType);^M
   if (msgType.equals("ORU") == true) {^M
   log.info("Dictaphone_In: MsgType ORU");^M
      Segment obrSegment = message.getSegment("OBR");^M
      if (obrSegment != null) {^M
         log.info("Dictaphone_In: OBR segment not null");^M
         String orderNo = obrSegment.getField(2).get(1).toString();^M
         if (obrSegment.getField(2).toString().length() == 0) {^M
            //message.receivingFacility = new Field("002");^M
            //message.sendingFacility = new Field("002");^M
            obrSegment.setField(2, new Field(""));^M
            log.info("Dictaphone to RMC: Non Order Based Transcripton #####");^M
         } else {^M
            message.sendingApplication = new Field("DPHO");^M
            log.info("Dictaphone to RMC:  Order Based Transcripton");^M
            if (obrSegment.getField(22).toString().length() == 0) {^M
                 resultDateField = obrSegment.getField(7);^M
                 obrSegment.setField(22,resultDateField);^M
message.messageType = new Field("KILL");^M
return;^M
            } ^M
         }      ^M
      }^M
   } ^M
            